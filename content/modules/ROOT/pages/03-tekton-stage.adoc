= Advanced Developer Suite Demo Instructions
Red Hat Advanced Developer Suite with Enterprise Contract and Artifact Signer
:source-highlighter: rouge
:toc: macro
:toclevels: 1

== Pipeline Flow

Know:: ACME's staging validation was taking 3-5 days and causing production surprises. RHADS transforms this into 30-minute automated validation with enterprise security built-in.

**Business Value:**

* Staging time: 3-5 days → 30 minutes
* Feature validation: Weeks → Hours  
* Zero manual coordination overhead
* Production-ready confidence every deployment

The moment ACME creates this tag, a GitLab webhook triggers the staging pipeline — proving that automation delivers both speed and quality.

[NOTE]
====
This simulates a release event. The moment this tag is created, a GitLab webhook kicks off the OpenShift Pipelines pipeline — the one that promotes the image to ACME's staging environment.
====

[NOTE]
====
The CLI approach does the same thing — triggers the pipeline tied to this Git tag.
====

[NOTE]
====
Use the Developer Hub view to explain each task as it executes. Let your audience see the automation in action — no manual approvals, just policy-driven promotion.
====

Show::

**Option 1: Tag via GitLab UI**

Walk the audience through the GitLab web interface:

* Open your GitLab repository {gitlab_url}/development/my-quarkus-tkn[my-quarkus-tkn^] and sign in using username `{gitlab_user}` and password `{gitlab_user_password}`.
+
image::tekton-stage-1.png[]
* In the left menu, click on *Code > Tags > New Tag*.
+
image::tekton-stage-2.png[]
* Enter a version tag like `v1.0`.
* Choose the target branch (typically `main`).
* Click *Create Tag*.
+
image::tekton-stage-3.png[]

=== Option 2: Tag via Git CLI

If you prefer the CLI, demonstrate with:

[source,bash]
----
git tag v1.0
git push --tags
----

Now guide your audience to *Developer Hub*:

* Go to the *my-quarkus-tkn* component.
* Click the *CI* tab to see pipeline runs.
* Expand the job labeled *promote-to-stage* to follow its progress.
+
image::tekton-stage-4.png[]


== Pipeline Tasks

Know:: ACME's staging pipeline provides production-level confidence while eliminating manual bottlenecks.

**Business Value:**

* Staging time: 3-5 days → 30 minutes
* Zero manual coordination overhead
* Production-grade validation catches issues early
* Platform teams focus on innovation, not deployment coordination

=== Task 1.1: Extract Destination Image Tag

Know:: ACME gets perfect traceability — Git tags enable coordinated feature rollouts and complete audit trails.

=== Task 1.2: Gather Images to Verify

Know:: ACME ensures staging perfectly mirrors production — same validated images eliminate "works in staging, fails in production" surprises.

The `images.json` file becomes ACME's guarantee that staging validation represents real production deployment quality.

[NOTE]
====
This mapping between Git commit and container image provides end-to-end traceability — we know exactly what code went into what image.
====

=== Task 2: Verify Enterprise Contract

Know:: ACME's most critical business protection for staging — automated security validation that catches compliance issues before they become expensive production problems or audit failures.

**Business Risk Without Staging Security Validation:**
* Security vulnerabilities discovered in production cost millions in incident response
* Compliance violations found during audits trigger expensive remediation projects
* Manual security reviews create 1-2 week staging deployment delays
* Inconsistent security standards between staging and production environments

**RHADS Business Protection for ACME:**
* **Early Risk Detection:** Security issues caught in staging, not production
* **Compliance Confidence:** Same security standards as production, ensuring audit readiness
* **Zero Deployment Delays:** Security validation happens automatically in minutes
* **Cost Avoidance:** Preventing one production security incident pays for the entire platform

**Enterprise Security Validations in Staging:**
* **Cosign signature verification:** Ensures staging uses only trusted, signed images
* **SBOM presence validation:** Complete dependency scanning for vulnerability management
* **Provenance verification:** Confirms staging images came from trusted build processes
* **CVE scanning:** Automatic vulnerability detection before production exposure
* **Policy compliance:** Enterprise security rules enforced consistently

**Business Impact for ACME:**
* Security incident prevention: Issues caught before customer exposure
* Audit confidence: Staging proves production security compliance
* Deployment velocity: Minutes for security validation instead of weeks
* Risk mitigation: 100% consistent security enforcement across environments

This step enforces multiple critical validations that protect ACME's business and customers.

[IMPORTANT]
====
If any check fails, the pipeline halts. If everything passes, the image moves forward to the next promotion step.
====

=== Task 3: Copy Image

Know:: ACME's quality gateway — only validated, compliant images reach staging, ensuring production-grade quality.

[IMPORTANT]
====
This guarantees that only validated artifacts are promoted — no sneaky image changes slip through.
====

=== Task 4: Update Deployment

Know:: ACME's automated bridge — GitOps ensures validated changes reach staging automatically, enabling immediate feature validation.
* **Continuous Readiness:** Staging environment always reflects the latest validated features

**Business Impact:**
* **Faster Feature Validation:** QA teams can test immediately after development completion
* **Reduced Production Risk:** Staging catches configuration and integration issues early
* **Team Efficiency:** No manual coordination needed for staging deployments
* **Release Confidence:** Staging success reliably predicts production success

The GitOps overlay system ensures ACME's staging environment stays current, secure, and production-representative.

[NOTE]
====
No manual `kubectl`, no YAML editing in the console — the system reacts to Git. That's the GitOps advantage.
====

Show::

**Task 2: Verify Enterprise Contract Commands**

First, the pipeline bootstraps trust using `cosign` and a local TUF (The Update Framework) server:

[source,bash]
----
cosign initialize \
  --mirror https://tuf.tssc-tas.svc \
  --root https://tuf.tssc-tas.svc/root.json
----

Then, the Enterprise Contract CLI performs validation:

[source,bash]
----
ec validate image \
  --image quay.tssc-quay/tssc/my-quarkus-tkn:abc123... \
  --policy default \
  --public-key k8s://openshift/trusted-keys \
  --output json
----

.Sample output
[source,json]
----
{
  "successes": [
    "Image is signed and verified with cosign",
    "SBOM (CycloneDX) is present",
    "Provenance attestation matches source repo",
    "No critical vulnerabilities found"
  ],
  "failures": []
}
----

=== Task 2: Sample images.json

.Sample `images.json`
[source,json,subs="attributes"]
----
{
  "components": [
    {
      "containerImage": "quay.tssc-quay/tssc/my-quarkus-tkn:abc123def456",
      "source": {
        "git": {
          "url": "{gitlab_url}/development/my-quarkus-tkn",
          "revision": "abc123def456"
        }
      }
    }
  ]
}
----

=== Task 3: Copy Image Command

Use `skopeo` to copy and retag the image:

[source,bash]
----
skopeo copy \
  docker://quay.tssc-quay/tssc/my-quarkus-tkn:abc123... \
  docker://quay.tssc-quay/tssc/my-quarkus-tkn:v1.0
----

=== Task 4: Update Deployment Files

.`kustomization.yaml`
[source,yaml]
----
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
patchesStrategicMerge:
  - deployment-patch.yaml
resources:
  - ../../base
----

.`deployment-patch.yaml`
[source,yaml]
----
apiVersion: apps/v1
kind: Deployment
metadata:
  name: my-quarkus-tkn
spec:
  template:
    spec:
      containers:
        - name: my-quarkus-tkn
          image: quay.tssc-quay/tssc/my-quarkus-tkn:v1.0
----

.Example Git diff
[source,diff]
----
-          image: quay.io/redhat-appstudio/rhtap-task-runner:latest
+          image: quay.tssc-quay/tssc/my-quarkus-tkn:v1.0
----

== Part 5 — Wrap-Up

=== Summary

|===
| Phase | Purpose

| 1.1 extract-destination-image-tag
| Extracts the commit ID of the Git tag. The commit ID is the image tag of the image we are promoting to `stage`.

| 1.2 gather-images-to-verify
| Selects the image based on the commit ID and generates `images.json`.

| 2 verify-enterprise-contract
| Validates signature, SBOM, provenance, CVEs — all enforced via the EC CLI.

| 3 copy-image
| Promotes the validated image with a human-readable tag (e.g., `v1.0`).

| 4 update-deployment
| Updates `overlays/stage` to trigger Argo CD deployment.
|===

=== Key Takeaways

Know:: ACME's staging transformation delivers faster, safer feature delivery.

**Business Value:**

* Staging time: 3-5 days → 30 minutes
* Production-grade validation catches issues early
* Zero manual coordination overhead
* Teams trust staging validation represents production reality

=== Optional Enhancements

Know:: Optional demonstrations to show ACME's staging transformation — simulate failed validations, display Quay image tags, demonstrate Argo CD syncing, and show Enterprise Contract policies.

