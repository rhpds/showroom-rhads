= Advanced Developer Suite Demo Instructions
Red Hat Advanced Developer Suite with Enterprise Contract and Artifact Signer
:numbered: false
:sectnums!:
:chapter-signifier:
:source-highlighter: rouge
:toc: macro
:toclevels: 1

== Pipeline Flow

Know:: ACME Retail's staging deployments are critical for validating features before Black Friday — this shows how RHADS transforms risky manual staging processes into confident automated validation that accelerates delivery while reducing risk.

**ACME's Traditional Staging Challenges:**
* Manual staging deployments take 3-5 days of platform team coordination
* Inconsistent validation processes lead to production surprises
* Security checks often skipped under deadline pressure
* Each staging deployment requires manual testing and approval cycles

**Business Impact of Slow Staging:**
* Feature validation delays push back production releases by weeks
* Manual processes don't scale during high-velocity development periods
* Staging issues discovered late become expensive production problems
* Teams lose confidence in staging as a reliable production preview

**How RHADS Solves ACME's Staging Bottleneck:**
* **Instant Staging Validation:** Git tag triggers immediate, automated promotion to staging
* **Production-Like Security:** Same validation policies as production, catching issues early
* **Zero Manual Overhead:** Platform teams focus on innovation instead of deployment coordination
* **Continuous Confidence:** Every staging deployment proves production readiness

**Business Value for ACME:**
* Staging deployment time: 3-5 days → 30 minutes
* Feature validation cycles: Weeks → Hours
* Production incident prevention: Early detection of integration issues
* Developer velocity: No waiting for staging environment access

The moment ACME creates this tag, a GitLab webhook triggers the staging pipeline — proving that automation delivers both speed and quality.

[NOTE]
====
This simulates a release event. The moment this tag is created, a GitLab webhook kicks off the OpenShift Pipelines pipeline — the one that promotes the image to ACME's staging environment.
====

[NOTE]
====
The CLI approach does the same thing — triggers the pipeline tied to this Git tag.
====

[NOTE]
====
Use the Developer Hub view to explain each task as it executes. Let your audience see the automation in action — no manual approvals, just policy-driven promotion.
====

Show::

=== Option 1: Tag via GitLab UI

Walk the audience through the GitLab web interface:

. Open your GitLab repository {gitlab_url}/development/my-quarkus-tkn[my-quarkus-tkn^] and sign in using username `{gitlab_user}` and password `{gitlab_user_password}`.
+
image::tekton-stage-1.png[]
. In the left menu, click on *Code > Tags > New Tag*.
+
image::tekton-stage-2.png[]
. Enter a version tag like `v1.0`.
. Choose the target branch (typically `main`).
. Click *Create Tag*.
+
image::tekton-stage-3.png[]

=== Option 2: Tag via Git CLI

If you prefer the CLI, demonstrate with:

[source,bash]
----
git tag v1.0
git push --tags
----

Now guide your audience to *Developer Hub*:

. Go to the *my-quarkus-tkn* component.
. Click the *CI* tab to see pipeline runs.
. Expand the job labeled *promote-to-stage* to follow its progress.
+
image::tekton-stage-4.png[]


== Pipeline Tasks

Know:: ACME's leadership needs to see that staging deployments now provide production-level confidence while eliminating manual bottlenecks — each pipeline task proves that automation delivers both speed and quality assurance.

**Business Value of Automated Staging Pipeline:**
* **Risk Reduction:** Production-grade validation in staging prevents costly production incidents
* **Velocity Increase:** Zero manual staging bottlenecks accelerate feature delivery cycles  
* **Confidence Building:** Staging becomes a reliable predictor of production success
* **Cost Efficiency:** Platform teams scale without proportional staging overhead

**ACME's Staging Success Metrics:**
* Staging validation time: Manual days → Automated minutes
* Production incident prevention: Early detection of integration and security issues
* Developer productivity: No waiting for staging environment access or manual approvals
* Platform team efficiency: Focus on innovation instead of deployment coordination

=== Task 1.1: Extract Destination Image Tag

Know:: ACME requires perfect traceability for compliance and quality assurance — this task ensures every staging deployment can be tracked from source code to business feature validation.

**Business Value for ACME:**
* **Release Coordination:** Clear version tracking enables coordinated feature rollouts
* **Quality Assurance:** QA teams know exactly which features they're validating in staging
* **Issue Resolution:** If staging issues arise, teams know exactly what code is involved
* **Audit Trail:** Complete traceability for compliance and release management

The Git tag (e.g., `v1.0`) becomes ACME's coordinate system for organizing feature validation and release planning across teams.

=== Task 1.2: Gather Images to Verify

Know:: ACME's business depends on staging environments that perfectly mirror production — this task ensures the exact same artifacts tested in staging will be deployed to production, eliminating deployment surprises.

**Traditional ACME Challenge:**
* Different images between staging and production caused production surprises
* Manual image tracking led to "works in staging, fails in production" incidents
* Unclear provenance made issue diagnosis difficult and time-consuming

**RHADS Business Solution:**
* **Perfect Consistency:** Same validated images from development to staging to production
* **Issue Prevention:** Staging truly represents what customers will experience
* **Rapid Diagnosis:** Complete image provenance available for quick troubleshooting
* **Confidence Building:** Teams trust that staging validation predicts production success

**Business Impact:**
* Production surprise elimination: Staging becomes a reliable production preview
* Incident reduction: Issues caught in staging, not production
* Deployment confidence: Teams trust the staging validation process
* Customer satisfaction: Fewer production issues mean better customer experience

The `images.json` file becomes ACME's guarantee that staging validation represents real production deployment quality.

[NOTE]
====
This mapping between Git commit and container image provides end-to-end traceability — we know exactly what code went into what image.
====

=== Task 2: Verify Enterprise Contract

Know:: ACME's most critical business protection for staging — automated security validation that catches compliance issues before they become expensive production problems or audit failures.

**Business Risk Without Staging Security Validation:**
* Security vulnerabilities discovered in production cost millions in incident response
* Compliance violations found during audits trigger expensive remediation projects
* Manual security reviews create 1-2 week staging deployment delays
* Inconsistent security standards between staging and production environments

**RHADS Business Protection for ACME:**
* **Early Risk Detection:** Security issues caught in staging, not production
* **Compliance Confidence:** Same security standards as production, ensuring audit readiness
* **Zero Deployment Delays:** Security validation happens automatically in minutes
* **Cost Avoidance:** Preventing one production security incident pays for the entire platform

**Enterprise Security Validations in Staging:**
* **Cosign signature verification:** Ensures staging uses only trusted, signed images
* **SBOM presence validation:** Complete dependency scanning for vulnerability management
* **Provenance verification:** Confirms staging images came from trusted build processes
* **CVE scanning:** Automatic vulnerability detection before production exposure
* **Policy compliance:** Enterprise security rules enforced consistently

**Business Impact for ACME:**
* Security incident prevention: Issues caught before customer exposure
* Audit confidence: Staging proves production security compliance
* Deployment velocity: Minutes for security validation instead of weeks
* Risk mitigation: 100% consistent security enforcement across environments

This step enforces multiple critical validations that protect ACME's business and customers.

[IMPORTANT]
====
If any check fails, the pipeline halts. If everything passes, the image moves forward to the next promotion step.
====

=== Task 3: Copy Image

Know:: ACME's quality gateway for staging readiness — only images that pass enterprise security validation earn the staging deployment designation, ensuring staging truly represents production quality.

**Business Value of Staging Image Promotion:**
* **Quality Assurance:** Only validated, compliant images reach ACME's staging environment
* **Consistency Guarantee:** Same image promotion process for staging and production
* **Deployment Confidence:** Teams trust that staging validation represents production quality
* **Risk Management:** Impossible to accidentally deploy non-validated code to staging

**Why This Matters for ACME's Business:**
* **Staging Reliability:** Staging becomes a true production preview environment
* **Issue Prevention:** Quality problems caught before expensive production incidents
* **Process Standardization:** Same validation rigor across all ACME environments
* **Customer Protection:** Features validated with production-grade security in staging

The human-readable tag (`v1.0`) signals that this image met ACME's enterprise standards and is ready for business validation.

[IMPORTANT]
====
This guarantees that only validated artifacts are promoted — no sneaky image changes slip through.
====

=== Task 4: Update Deployment

Know:: ACME's automated bridge from security validation to business feature testing — GitOps ensures validated changes reach staging automatically, enabling immediate feature validation without deployment delays.

**Traditional ACME Staging Deployment Risks:**
* Manual staging deployments prone to configuration errors
* Emergency feature testing bypassed proper validation processes
* Inconsistent staging configurations led to production surprises
* Manual deployment steps delayed feature validation cycles

**RHADS Business Benefits for ACME:**
* **Zero Deployment Errors:** GitOps automation eliminates manual staging mistakes
* **Immediate Validation:** Features available for testing within minutes of validation
* **Consistent Environments:** Staging perfectly mirrors production configuration
* **Continuous Readiness:** Staging environment always reflects the latest validated features

**Business Impact:**
* **Faster Feature Validation:** QA teams can test immediately after development completion
* **Reduced Production Risk:** Staging catches configuration and integration issues early
* **Team Efficiency:** No manual coordination needed for staging deployments
* **Release Confidence:** Staging success reliably predicts production success

The GitOps overlay system ensures ACME's staging environment stays current, secure, and production-representative.

[NOTE]
====
No manual `kubectl`, no YAML editing in the console — the system reacts to Git. That's the GitOps advantage.
====

Show::

=== Task 2: Verify Enterprise Contract Commands

First, the pipeline bootstraps trust using `cosign` and a local TUF (The Update Framework) server:

[source,bash]
----
cosign initialize \
  --mirror https://tuf.tssc-tas.svc \
  --root https://tuf.tssc-tas.svc/root.json
----

Then, the Enterprise Contract CLI performs validation:

[source,bash]
----
ec validate image \
  --image quay.tssc-quay/tssc/my-quarkus-tkn:abc123... \
  --policy default \
  --public-key k8s://openshift/trusted-keys \
  --output json
----

.Sample output
[source,json]
----
{
  "successes": [
    "Image is signed and verified with cosign",
    "SBOM (CycloneDX) is present",
    "Provenance attestation matches source repo",
    "No critical vulnerabilities found"
  ],
  "failures": []
}
----

=== Task 2: Sample images.json

.Sample `images.json`
[source,json,subs="attributes"]
----
{
  "components": [
    {
      "containerImage": "quay.tssc-quay/tssc/my-quarkus-tkn:abc123def456",
      "source": {
        "git": {
          "url": "{gitlab_url}/development/my-quarkus-tkn",
          "revision": "abc123def456"
        }
      }
    }
  ]
}
----

=== Task 3: Copy Image Command

Use `skopeo` to copy and retag the image:

[source,bash]
----
skopeo copy \
  docker://quay.tssc-quay/tssc/my-quarkus-tkn:abc123... \
  docker://quay.tssc-quay/tssc/my-quarkus-tkn:v1.0
----

=== Task 4: Update Deployment Files

.`kustomization.yaml`
[source,yaml]
----
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
patchesStrategicMerge:
  - deployment-patch.yaml
resources:
  - ../../base
----

.`deployment-patch.yaml`
[source,yaml]
----
apiVersion: apps/v1
kind: Deployment
metadata:
  name: my-quarkus-tkn
spec:
  template:
    spec:
      containers:
        - name: my-quarkus-tkn
          image: quay.tssc-quay/tssc/my-quarkus-tkn:v1.0
----

.Example Git diff
[source,diff]
----
-          image: quay.io/redhat-appstudio/rhtap-task-runner:latest
+          image: quay.tssc-quay/tssc/my-quarkus-tkn:v1.0
----

== Part 5 — Wrap-Up

=== Summary

|===
| Phase | Purpose

| 1.1 extract-destination-image-tag
| Extracts the commit ID of the Git tag. The commit ID is the image tag of the image we are promoting to `stage`.

| 1.2 gather-images-to-verify
| Selects the image based on the commit ID and generates `images.json`.

| 2 verify-enterprise-contract
| Validates signature, SBOM, provenance, CVEs — all enforced via the EC CLI.

| 3 copy-image
| Promotes the validated image with a human-readable tag (e.g., `v1.0`).

| 4 update-deployment
| Updates `overlays/stage` to trigger Argo CD deployment.
|===

=== Key Takeaways

Know:: ACME's staging transformation demonstrates how automated validation creates business value by enabling faster, safer feature delivery:

**Business Results Achieved:**
* **Staging Speed:** Deployment time from 3-5 days → 30 minutes
* **Quality Assurance:** Production-grade validation catches issues early
* **Team Efficiency:** Zero manual staging coordination overhead
* **Risk Reduction:** Staging becomes reliable predictor of production success
* **Developer Velocity:** No waiting for staging environment access

**Strategic Business Value:**
* **Faster Time-to-Market:** Features validated quickly without compromising quality
* **Cost Avoidance:** Staging catches expensive production issues before customer impact
* **Operational Excellence:** Consistent, automated processes across all environments
* **Confidence Building:** Teams trust staging validation represents production reality
* **Platform Scaling:** Automated staging supports rapid team and application growth

**Why This Matters for Your Business:**
* Staging environments that teams actually trust and use effectively
* Security and compliance validation happens early, not at production gates
* Platform teams focus on innovation instead of manual deployment coordination
* Development velocity increases without compromising enterprise security standards

=== Optional Enhancements

Know:: These demonstrations can reinforce ACME's staging transformation and address specific customer concerns:

**Demonstrating ACME's Quality Protection:**
* Simulate a failed validation scenario to show Enterprise Contract blocking unsafe deployments
* Show how ACME's quality gates prevent issues from reaching production

**Showing ACME's Operational Excellence:**
* Display the new image tag (e.g., `v1.0`) in the Quay UI showing staging readiness
* Demonstrate Argo CD interface syncing the deployment after GitOps changes

**Proving ACME's Business Value:**
* Show the Enterprise Contract policy bundle that defines ACME's quality standards
* Explain how the same validation process ensures consistency between staging and production

These enhancements prove that ACME achieved staging efficiency without compromising quality or security.

