= Advanced Developer Suite Demo Instructions
Red Hat Advanced Developer Suite with Enterprise Contract and Artifact Signer
:numbered: false
:sectnums!:
:chapter-signifier:
:source-highlighter: rouge
:toc: macro
:toclevels: 1

toc::[]

== Overview

Know:: ACME Retail's staging deployments are critical for validating checkout service features before Black Friday using their existing Jenkins infrastructure — this demonstrates how RHADS transforms risky manual staging processes into confident automated validation that accelerates delivery while preserving valuable Jenkins investments.

**ACME's Traditional Jenkins Staging Challenges:**
* Manual Jenkins staging deployments require 3-5 days of platform team coordination
* Inconsistent validation processes in Jenkins lead to production surprises
* Security checks often skipped under deadline pressure in Jenkins workflows
* Each staging deployment requires manual testing and approval cycles through Jenkins

**Business Impact of Slow Jenkins Staging for ACME:**
* Feature validation delays push back production releases by weeks
* Manual Jenkins processes don't scale during high-velocity development periods
* Staging issues discovered late become expensive production problems
* Teams lose confidence in Jenkins staging as a reliable production preview

**How RHADS Solves ACME's Jenkins Staging Bottleneck:**
* **Instant Staging Validation:** Git tag triggers immediate, automated promotion through enhanced Jenkins
* **Production-Like Security:** Same validation policies as production, catching issues early in Jenkins
* **Zero Manual Overhead:** Platform teams focus on innovation instead of Jenkins deployment coordination
* **Continuous Confidence:** Every Jenkins staging deployment proves production readiness

**Business Value for ACME:**
* Jenkins staging deployment time: 3-5 days → 30 minutes
* Feature validation cycles: Weeks → Hours using automated Jenkins
* Production incident prevention: Early detection of integration issues
* Developer velocity: No waiting for staging environment access through Jenkins

**Investment Protection Benefits:**
* Leverage existing Jenkins infrastructure worth millions while adding modern capabilities
* Preserve Jenkins expertise and team knowledge while enhancing productivity
* Maintain familiar Jenkins workflows while gaining enterprise-grade validation
* Transform Jenkins from staging bottleneck to competitive advantage

The moment ACME creates this tag, a GitLab webhook triggers the staging pipeline — proving that automation delivers both speed and quality through enhanced Jenkins infrastructure.

This guide is designed for technical sales engineers to demonstrate a secure software supply chain using:

- Red Hat Advanced Developer Suite (ADS)
- Enterprise Contract (EC)
- GitOps with Argo CD
- Artifact Signer

The goal of the demo is to show how tagging a release in Git can trigger a Jenkins pipeline that:

- Validates the container image using Enterprise Contract
- Tags the verified image using the Git tag value
- Promotes the image to the staging environment via GitOps
- Automatically deploys the application using Argo CD

The demo uses a Jenkins pipeline that relies on a shared Jenkins library:
`RHTAP_Jenkins@main`

[NOTE]
====
The code snippets in this guide are provided for illustrative and simplified purposes, as they are intended for demonstration only. Always refer to the actual Jenkins pipeline and repository configuration for production-ready details.
====

== Starting the Demo: Tag the Release

Know:: ACME's transformation from manual Jenkins staging coordination to instant automated validation — showing how a simple Git tag action triggers enterprise-grade staging deployment automatically while preserving familiar Jenkins workflows.

**ACME's Traditional Jenkins Staging Initiation:**
* Platform team manually schedules Jenkins staging deployments during specific maintenance windows
* Development teams wait 2-3 days for Jenkins staging environment availability
* Manual coordination between multiple teams before Jenkins staging deployment
* Emergency staging requests often bypass proper Jenkins validation under deadline pressure

**Business Cost of Manual Jenkins Staging Coordination:**
* Each staging deployment requires 15+ hours of cross-team coordination
* Staging delays cost ACME competitive advantage during feature development cycles
* Manual Jenkins processes create unpredictable staging timelines for business planning
* Teams lose development momentum waiting for Jenkins staging availability

**RHADS Business Benefits for ACME's Jenkins Staging:**
* **Instant Staging Access:** Git tag immediately triggers Jenkins staging deployment
* **Zero Coordination Overhead:** No manual scheduling or team coordination required
* **Predictable Staging Timeline:** Consistent Jenkins staging deployment within minutes
* **Business Velocity:** Features validated quickly using enhanced Jenkins infrastructure

**Business Impact for ACME:**
* Staging coordination time: 2-3 days → Instant through Git tag
* Platform team efficiency: 80% reduction in Jenkins staging requests
* Development velocity: No staging bottlenecks using automated Jenkins
* Feature validation speed: Days → Minutes for business feedback

Let your audience know that this demo is initiated by tagging a release in Git. This Git event triggers a Jenkins pipeline which performs validation and promotes the image to staging.

Choose one of the following methods to create the tag:

Show::

=== Option 1: Tag via GitLab UI

. Open your GitLab repository {gitlab_url}/development/my-quarkus-jnk[my-quarkus-jnk^] and sign in using username `{gitlab_user}` and password `{gitlab_user_password}`.
+
image::jenkins-stage-1.png[]
. In the left navigation menu, go to *Code > Tags > New Tag*
+
image::jenkins-stage-2.png[]
. Fill in the tag details:
  - **Tag name**: `v1.0`
  - **Target branch**: `main`
. Click *Create Tag*
+
image::jenkins-stage-3.png[]

=== Option 2: Tag via Git CLI

Alternatively, you can trigger the pipeline by pushing a Git tag from your local machine:

[source,bash]
----
git tag v1.0
git push --tags
----

Now guide your audience to *Developer Hub*:

. On the left menu, click on *Catalog*, then under *Kind* `Component`, click *my-quarkus-jnk* component.
+
image::jenkins-stage-7.png[]
. Click the *CI* tab to see pipeline runs.
. Click on the *View build* icon on the *promote-to-stage* build to follow progress
+
image::jenkins-stage-4.png[]
. Click *Open Blue Ocean* to view the pipeline stages
+
image::jenkins-stage-5.png[]

Tell your audience:
"This run is triggered by the Git tag and promotes the image to staging, while validating it with Enterprise Contract."

== Pipeline Tasks

Know:: ACME's leadership needs to see that Jenkins-based staging deployments are now safer AND faster than ever before — each pipeline task proves that automation enhances Jenkins capabilities while reducing business risk and accelerating feature validation.

**Business Value of Enhanced Jenkins Staging Pipeline:**
* **Investment Protection:** Leverage existing Jenkins infrastructure worth millions while adding modern staging capabilities
* **Feature Validation:** Critical staging validation happens in minutes instead of days through Jenkins
* **Risk Prevention:** Security violations caught in Jenkins staging before they reach production
* **Quality Assurance:** Every staging deployment through Jenkins proves production readiness

**Traditional vs. Enhanced Jenkins for ACME Staging:**

| Traditional ACME Jenkins Staging | RHADS-Enhanced Jenkins Staging |
|----------------------------------|--------------------------------|
| Manual coordination: 3-5 days | Automated trigger: Minutes |
| Inconsistent validation: High risk | Standardized validation: Zero risk |
| Manual security checks: Often skipped | Automated security: Always enforced |
| Platform team bottleneck: Delays | Self-service staging: Instant |

**Strategic Business Value for ACME:**
* **Feature Velocity:** Validate features using Jenkins while competitors wait for staging access
* **Quality Confidence:** Enhanced Jenkins staging ensures production readiness
* **Cost Efficiency:** Platform teams focus on innovation instead of manual Jenkins coordination
* **Risk Management:** Enterprise-grade validation without enterprise-grade delays using familiar Jenkins tools

image::jenkins-stage-6.png[]

Let's walk through what happens in each step of the Jenkins pipeline as we promote the image to stage. Each task here is essential for ensuring a secure and trusted software delivery pipeline.

=== Task 1: gather-images

Know:: ACME requires perfect traceability for staging validation using their Jenkins infrastructure — this task ensures every staging deployment can be traced back to its exact source through familiar Jenkins processes while providing audit confidence.

**Business Value for ACME's Jenkins Staging:**
* **Feature Traceability:** Every staging deployment links back to specific developer changes through Jenkins
* **Quality Assurance:** Staging validation proves the exact code that will reach production
* **Development Confidence:** Teams know precisely what is being validated in Jenkins staging
* **Investment Leverage:** Existing Jenkins expertise becomes more valuable with enhanced traceability

**Why This Matters for ACME's Business:**
* **Risk Management:** If staging issues arise, ACME knows exactly what was deployed through Jenkins tracking
* **Audit Readiness:** Complete staging evidence trail through Jenkins for compliance reviews
* **Quality Control:** Staging validation only happens on properly tracked and approved changes
* **Development Velocity:** No confusion about what's being validated in Jenkins staging

The first thing Jenkins needs to know is: what exactly are we promoting? This step is where we identify the image to promote. During the build phase the image built was tagged with the commit id of the change made in the repository. Here we resolve the Git tag back to its commit and match that to the image.

This gets written into an `images.json` file — which becomes the authoritative source for what we'll verify and promote. This file becomes the source of truth for the validation step. It captures both the image and its corresponding source code revision.

=== Task 2: verify-ec

Know:: ACME's most critical staging protection through enhanced Jenkins — automated security validation that prevents costly staging issues while eliminating manual security review delays in familiar Jenkins workflows before features reach production.

**Business Risk Without Automated Jenkins Staging Security:**
* Staging security vulnerabilities could leak into production costing ACME millions
* Manual security reviews in Jenkins staging create 1-2 week validation delays
* Human error in Jenkins staging checks leads to production incidents
* Inconsistent staging security standards across different Jenkins teams

**RHADS Business Protection for ACME's Jenkins Staging:**
* **Zero Staging Security Incidents:** Automated validation in Jenkins catches issues before production
* **100% Consistent Standards:** Every Jenkins staging deployment meets the same enterprise security policies
* **Instant Staging Validation:** Security validation in Jenkins staging happens in minutes, not weeks
* **Production Confidence:** Only security-validated features progress from Jenkins staging

**Enterprise Staging Security Validations in ACME's Jenkins Pipeline:**
* **Digital signature verification:** Proves staging images haven't been tampered with
* **SBOM validation:** Complete dependency scanning for staging vulnerability management
* **Provenance verification:** Confirms staging images came from trusted build processes
* **CVE scanning:** Automatic vulnerability detection and policy enforcement in staging
* **Organizational policy compliance:** Custom ACME security rules enforced automatically in Jenkins staging

**Business Impact for ACME:**
* Staging security incident prevention: Saves potential millions through automated Jenkins validation
* Feature validation confidence: 100% security-validated features in staging
* Staging deployment velocity: Minutes instead of weeks for security approval through Jenkins
* Production readiness: Jenkins staging validates exactly what will reach customers

Now comes the security gate. We validate that the image is signed, scanned, and compliant before it goes to production.

Jenkins runs the `verify-ec` stage using the Red Hat Trusted Application Pipeline shared library. It initializes Cosign trust using a TUF server to ensure validation only accepts trusted roots, then validates the image using Enterprise Contract.

- `ec validate` means "Enterprise Contract is now checking your image"
- `--image` is the container image you want to validate
- `--policy` is the set of rules it must follow (stored in Git)
- `--public-key` is used to confirm the image was signed by someone trusted
- `--output json` gives a clear pass/fail report in JSON format

.Validation checks performed:

- *Digital signature (Cosign)*
  → Confirms the image wasn't tampered with and came from a trusted build system.

- *SBOM (Software Bill of Materials)*
  → A list of everything that went into the image — like an ingredients label for software.

- *Provenance metadata*
  → Details of how and where the image was built (e.g., which pipeline, commit, environment).

- *CVE scanning*
  → Checks for known security vulnerabilities (Critical or High ones cause failure).

- *Organizational policy compliance*
  → Enforces any rules set by your security or platform team.

Tell your audience:

> "If any of these checks fail, the pipeline stops — which means no risky code makes it to the next stage."

Optional: Simulate a failed validation by pushing an unsigned image or one missing SBOM to show enforcement in action.

=== Task 3: update-image-tag-for-stage

Know:: ACME's staging quality gate for production readiness through Jenkins — only images that pass enterprise security validation earn the "staging-ready" designation, ensuring staging deployments represent true quality and security standards for Black Friday features.

**Business Value of Staging Tagging in ACME's Jenkins:**
* **Clear Staging Intent:** Release version tag signals this image passed all enterprise security checks in Jenkins staging
* **Feature Validation:** Complete traceability from source code to staging deployment through Jenkins
* **Quality Assurance:** Only validated, compliant features can be tested in ACME's staging through Jenkins workflows
* **Production Preview:** Staging becomes accurate production preview using Jenkins-validated images

**Why This Matters for ACME's Business:**
* **Feature Confidence:** Only security-validated features deployed through Jenkins to staging environment
* **Staging Reliability:** Jenkins audit trail proving every staging feature was properly validated
* **Quality Excellence:** Clear separation between development and staging-ready features in Jenkins
* **Risk Management:** Impossible to accidentally deploy non-validated features through Jenkins staging

Now that the image has passed all security gates, we give it a special tag to mark it as ready for stage i.e qa.

In the `update-image-tag-for-stage` stage, Jenkins uses `skopeo` to copy the image and apply a new tag. Once the image passes validation, this step applies a release version tag:

- Applies a human-readable version tag to the validated image.
- Ensures only verified images are tagged for release.
- This tagged image is used for deployment to the `stage` environment.

=== Task 4: deploy-to-stage

Know:: ACME's automated bridge from Jenkins staging validation to feature testing — GitOps ensures validated changes reach staging automatically without manual intervention or risk while leveraging familiar Jenkins workflows for business feedback cycles.

**Traditional ACME Jenkins Staging Deployment Risks:**
* Manual Jenkins staging deployment steps prone to human error during critical feature validation
* Emergency staging changes bypass proper Jenkins validation under deadline pressure
* Inconsistent Jenkins staging deployment processes across different teams
* Staging changes without proper audit trails through Jenkins

**RHADS Business Benefits for ACME's Jenkins Staging:**
* **Zero Manual Errors:** GitOps automation eliminates human staging deployment mistakes in Jenkins workflows
* **100% Staging Audit Trail:** Every staging change tracked and traceable through Jenkins
* **Consistent Process:** Same Jenkins staging deployment method for routine and emergency features
* **Continuous Validation:** All staging changes follow the same validated Jenkins security process

**Business Impact for ACME:**
* **Staging Confidence:** Jenkins and Argo CD ensure exactly what was validated gets deployed to staging
* **Risk Elimination:** No manual staging steps that could introduce errors during critical feature validation
* **Quality Automation:** Staging environment continuously reflects audited Git state through Jenkins
* **Feature Velocity:** Standardized Jenkins staging deployment process accelerates business feedback

With the stage image ready, the last step is to update the deployment configuration so Argo CD can roll it out.

In the `deploy-to-stage` stage, the pipeline uses `rhtap.update_deployment()` to patch the `kustomization.yaml` overlay for stage. This updates the image tag in the `deployment-patch.yaml` to reference the new qa-approved image.

Mention:
- Jenkins commits and pushes this change to the GitOps repository.
- Argo CD detects the update and syncs the deployment to the `stage` environment automatically.

Show::

=== Task 1: gather-images
Click on the 'gather-images' stage in the pipeline and click on the last step. This should show the below json:

[source,json,subs="attributes"]
----
{
  "components": [
    {
      "containerImage": "quay.tssc-quay/tssc/my-quarkus-jnk:123456",
      "source": {
        "git": {
          "url": "{gitlab_url}/development/my-quarkus-jnk",
          "revision": "123456"
        }
      }
    }
  ]
}
----

=== Task 2: verify-ec
. Jenkins runs the `verify-ec` stage using the Red Hat Trusted Application Pipeline shared library.
. It initializes Cosign trust using a TUF server to ensure validation only accepts trusted roots:

[source,bash]
----
cosign initialize \
  --mirror https://tuf.tssc-tas.dev \
  --root https://tuf.tssc-tas.dev/root.json
----

. It validates the image using Enterprise Contract:

[source,bash]
----
ec validate image \
  --image quay.tssc-quay/tssc/my-quarkus-jnk:123456 \
  --policy git::github.com/org/ec-policies//default \
  --public-key k8s://openshift/trusted-keys \
  --output json
----

.Sample output
[source,json]
----
{
  "successes": [
    "Image is signed and verified with cosign",
    "SBOM (CycloneDX) is present",
    "Provenance matches repository",
    "No critical vulnerabilities found"
  ],
  "failures": []
}
----

=== Task 3: update-image-tag-for-stage
In the `update-image-tag-for-stage` stage, Jenkins uses `skopeo` to copy the image and apply a new tag. Let the audience know that once the image passes validation, this step applies a release version tag:

[source,bash]
----
skopeo copy \
  docker://quay.tssc-quay/tssc/my-quarkus-jnk:123456 \
  docker://quay.tssc-quay/tssc/my-quarkus-jnk:v1.0
----

=== Task 4: deploy-to-stage
. In the `deploy-to-stage` stage, the pipeline uses `rhtap.update_deployment()` to patch the `kustomization.yaml` overlay for stage.
. This updates the image tag in the `deployment-patch.yaml` to reference the new qa-approved image.

The pipeline modifies:

`overlays/stage/deployment-patch.yaml`

[source,yaml]
----
apiVersion: apps/v1
kind: Deployment
metadata:
  name: my-quarkus-jnk
spec:
  template:
    spec:
      containers:
        - name: my-quarkus-jnk
          image: quay.tssc-quay/tssc/my-quarkus-jnk:v1.0
----

This patch is referenced by `kustomization.yaml`:

[source,yaml]
----
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
  - ../../base
patchesStrategicMerge:
  - deployment-patch.yaml
----

== Summary

Know:: ACME's Jenkins-based staging transformation demonstrates how enterprise investments can be enhanced rather than replaced — delivering modern security and business velocity while preserving valuable Jenkins infrastructure and team expertise for critical feature validation.

**Business Results Achieved by ACME:**
* **Staging Speed:** Jenkins staging deployment from 3-5 days → 30 minutes
* **Security Confidence:** 100% automated policy enforcement through enhanced Jenkins staging
* **Risk Reduction:** Eliminated human error from Jenkins staging deployment process
* **Feature Velocity:** No staging bottlenecks using automated Jenkins workflows
* **Investment Protection:** Jenkins infrastructure and expertise enhanced rather than replaced

**Strategic Business Value for ACME:**
* **Competitive Advantage:** Validate features using Jenkins while competitors wait for staging access
* **Feature Quality:** Confident Jenkins-based staging validation ensures production readiness
* **Cost Efficiency:** Platform teams focus on innovation instead of manual Jenkins staging coordination
* **Risk Management:** Enterprise-grade staging security without enterprise-grade delays using familiar Jenkins tools
* **Team Retention:** Jenkins experts become more valuable with enhanced staging capabilities rather than obsolete

**Why This Matters for Your Business:**
* Preserve and enhance millions in Jenkins infrastructure investment for staging
* Transform Jenkins from staging bottleneck to competitive advantage
* Maintain team expertise while gaining modern staging validation capabilities
* Achieve enterprise staging security without disrupting proven Jenkins workflows

To quickly summarize:

Show::

[cols="1,1",options="header"]
|===
| Step | Description

| Tag Push
| Triggers the staging pipeline and updates `overlays/stage/`

| gather-images
| Resolves the Git tag to a commit, generates `images.json` for validation

| verify-ec
| Validates the image signature, SBOM, provenance, CVEs, and policy compliance

| update-image-tag-for-stage
| Tags the verified image with the release version (e.g., `v1.0`)

| deploy-to-stage
| Updates the `overlays/stage` directory to trigger deployment via Argo CD
|===

== Key Takeaways

- Tagging a Git release initiates a secure image promotion process.
- Enterprise Contract enforces compliance, provenance, and security checks.
- Jenkins shared library `RHTAP_Jenkins@main` standardizes CI/CD workflows.
- GitOps overlays provide clear, auditable environment separation.
- Argo CD ensures continuous deployment aligned with Git state.

== Optional Enhancements

Use these to explore additional details during the demo:

- Simulate a failed Enterprise Contract validation by using an unsigned image
- Show the image in Quay with both tags: `:abc123` (commit) and `:v1.0` (release)
- Open the Argo CD UI and demonstrate syncing the `stage` environment
- Display the Enterprise Contract policy bundle used for validation
- Explain that production promotion uses a similar process, triggered by a GitLab release and applied to the `prod` overlay
