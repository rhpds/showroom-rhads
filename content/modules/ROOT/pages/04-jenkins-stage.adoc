= Advanced Developer Suite Demo Narrative
Red Hat Advanced Developer Suite with Enterprise Contract and GitOps Promotion using Jenkins
:icons: font
:source-highlighter: rouge
:toc: macro
:toclevels: 1

toc::[]

== Overview

=== Know
_ACME’s Black Friday success depends on fast, safe staging promotions to validate features before production. RHADS replaces slow manual reviews with automated Jenkins-based workflows that leverage existing investments._

**Business Value:**

* Staging deployment time: hours instead of days
* Preserves millions in Jenkins infrastructure investment
* Zero manual security review delays
* Complete SOC 2 and PCI audit trails automatically

This guide is designed for technical sales engineers to demonstrate a secure software supply chain using:

- Red Hat Advanced Developer Suite (ADS)
- Enterprise Contract (EC)
- GitOps with Argo CD
- Artifact Signer

The goal of the demo is to show how pushing a Git tag in GitLab can trigger a Jenkins pipeline that:

- Validates the container image using Enterprise Contract
- Tags the verified image using the Git tag value
- Promotes the image from the development environment to staging via GitOps
- Automatically deploys the application using Argo CD

The demo uses a Jenkins pipeline that relies on a shared Jenkins library:
`RHTAP_Jenkins@main`

[NOTE]
====
The code snippets in this guide are provided for illustrative and simplified purposes, as they are intended for demonstration only. Always refer to the actual Jenkins pipeline and repository configuration for production-ready details.
====

=== Show
* Push a Git tag to trigger a staging promotion
* Watch Jenkins validate and promote the image to the staging environment

== Git Tag – Promote to Staging

=== Know
_ACME’s staging promotions are now lightning-fast with Jenkins — a simple Git tag push validates code and moves it to staging without manual intervention._

**Business Value:**

* **Staging Speed:** Git tag push triggers instant validation and deployment  
* **Audit Trail:** Every staging change recorded automatically  
* **Developer Velocity:** Quick feedback on release readiness  
* **Risk Management:** Same pipeline enforces consistent policies

When a developer pushes a Git tag (e.g., `v1.0`), Jenkins is triggered via a webhook. The pipeline detects this as a *tag event* and switches into staging promotion mode.

This ensures that the latest validated image is promoted to the staging environment for further testing and verification.

=== Show
* Open your {gitlab_url}/development/my-quarkus-jnk GitLab repository and sign in with:
+
[subs=attributes+]
----
Username: {gitlab_user}
Password: {gitlab_user_password}
----
+
image::jenkins-stage-1.png[]
* Go to *Deploy > Tags*
* Click *New tag*, enter `v1.0`, and select the commit to tag
* Click *Create tag*
+
image::jenkins-stage-2.png[]

Now guide your audience to *Developer Hub*:

* On the left menu, click on *Catalog*, then under *Kind* `Component`, click *my-quarkus-jnk* component
+
image::jenkins-stage-3.png[]
* Click the *CI* tab to see pipeline runs
* Locate the build labeled **promote-to-stage**
* Click the *View build* icon to follow progress
+
image::jenkins-stage-4.png[]
* Click *Open Blue Ocean* to view the pipeline stages
+
image::jenkins-stage-5.png[]

== Pipeline Steps

=== Know
_ACME’s Jenkins staging promotion proves that automation can be fast, secure, and consistent — every step is enforced by policy before deployment._

**Business Value:**

* **Faster Validation:** Staging feedback in minutes, not days  
* **Security Automation:** Policies enforced automatically  
* **Consistency:** Same checks applied for every change  
* **Audit-Ready:** Complete record of what was deployed and when

=== Show
* **Gather Images:** Jenkins retrieves the Git tag, determines the corresponding container image from development, and records metadata in an `images.json` file for traceability.
+
.Example `images.json`
[source,json,subs="attributes"]
----
{
  "components": [
    {
      "containerImage": "quay.tssc-quay/tssc/my-quarkus-jnk:v1.0",
      "source": {
        "git": {
          "url": "{gitlab_url}/development/my-quarkus-jnk",
          "revision": "v1.0"
        }
      }
    }
  ]
}
----

* **Verify with Enterprise Contract:** Jenkins validates the image using EC, checking signatures, SBOM, provenance, CVEs, and custom org rules.  
+
Cosign trust initialization:
[source,bash]
----
cosign initialize \
  --mirror https://tuf.tssc-tas.dev \
  --root https://tuf.tssc-tas.dev/root.json
----
Enterprise Contract validation:
[source,bash]
----
ec validate image \
  --image quay.tssc-quay/tssc/my-quarkus-jnk:v1.0 \
  --policy default \
  --public-key k8s://openshift/trusted-keys \
  --output json
----

* **Update Image Tag for Staging:** Jenkins re-tags the verified image with the staging-specific tag, e.g., `stage-v1.0`, ensuring only validated images reach staging.  
+
[source,bash]
----
skopeo copy \
  docker://quay.tssc-quay/tssc/my-quarkus-jnk:v1.0 \
  docker://quay.tssc-quay/tssc/my-quarkus-jnk:stage-v1.0
----

* **Deploy to Staging via GitOps:** Jenkins updates the `kustomization.yaml` in the `overlays/stage/` directory of the GitOps repo. Argo CD detects the change and deploys it automatically.  
+
.Sample patch
[source,yaml]
----
apiVersion: apps/v1
kind: Deployment
metadata:
  name: my-quarkus-jnk
spec:
  template:
    spec:
      containers:
        - name: my-quarkus-jnk
          image: quay.tssc-quay/tssc/my-quarkus-jnk:stage-v1.0
----

== Summary

=== Know
_ACME’s staging promotions are now quick, secure, and fully traceable — accelerating feedback cycles while enforcing enterprise security standards._

**Business Value:**

* **Rapid Feedback:** Staging validation in minutes  
* **Security Assurance:** Automated checks before promotion  
* **Audit-Ready:** Complete traceability for every deployment  
* **Consistency:** Same process for all staging promotions

=== Show
Review the following flow:

[cols="1,1",options="header"]
|===
| Step | Description

| Git Tag Push
| Developer pushes a Git tag, triggering the Jenkins pipeline for staging promotion.

| Gather Images
| Jenkins retrieves the image from development and records its metadata.

| Verify with EC
| Image is validated for signatures, SBOM, provenance, and CVEs.

| Tag for Staging
| Image is re-tagged as `stage-<tag>` after passing checks.

| GitOps Update
| Jenkins updates the staging overlay in the GitOps repo, and Argo CD deploys it automatically.
|===
