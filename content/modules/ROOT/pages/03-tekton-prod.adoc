= Advanced Developer Suite Demo Narrative
Red Hat Advanced Developer Suite with Enterprise Contract and GitOps Promotion
:icons: font
:source-highlighter: rouge
:toc: macro
:toclevels: 1

toc::[]

== Overview

Know:: ACME's Black Friday success requires safe, fast production deployments. RHADS transforms risky manual processes into confident automated workflows.

**ACME's Production Deployment Challenge:**
* Traditional production releases take 2-3 weeks of manual security reviews
* Each production deployment risks downtime during peak shopping season
* Manual validation processes create opportunities for human error
* Security teams become bottlenecks during critical release cycles

**The Business Stakes:**
* Black Friday downtime could cost ACME $50,000+ per minute in lost sales
* Failed deployments during peak season damage customer trust and revenue
* Manual processes don't scale during high-velocity release periods
* Compliance violations could trigger expensive audit failures

**How RHADS Solves ACME's Production Risk:**
This module demonstrates how ACME now:

* Deploys to production with zero manual security reviews (saves 2-3 weeks per release)
* Automatically validates every production candidate before deployment
* Eliminates human error through automated policy enforcement
* Maintains complete audit trails for SOC 2 and PCI compliance

The result: ACME deploys confidently to production while reducing risk and accelerating delivery.

[NOTE]
====
The examples and commands in this guide are representative of the *ACME* demo environment. Actual repository URLs, credentials, or config should be replaced as needed in your setup.
====

== Pipeline Flow

Know:: ACME's transformation from manual production releases to automated confidence — showing how a simple Git release action triggers enterprise-grade security validation automatically.

**ACME's Traditional Production Release Process:**
* Platform team manually tags and validates images (2-4 days)
* Security team manually reviews every production candidate (1-2 weeks)
* Manual promotion steps with high error potential
* Emergency deployments bypass security controls under pressure

**RHADS Business Benefits for ACME:**

* **Zero Manual Bottlenecks:** GitLab release triggers automatic validation and deployment
* **100% Security Compliance:** Every production deployment automatically enforced by policy
* **Risk Elimination:** Impossible to bypass security controls, even under pressure
* **Audit Confidence:** Complete evidence trail generated automatically

**Business Impact:**

* Production deployment time: 2-3 weeks → 30 minutes
* Security review overhead: 100% manual → 100% automated
* Risk of failed deployments: High → Near zero
* Compliance evidence generation: Manual weeks → Automatic real-time

After creating the release, ACME teams use Developer Hub to watch each validation step — proving that speed and security deliver better business outcomes together.

Show::
* Open your GitLab repository: {gitlab_url}/development/my-quarkus-tkn[my-quarkus-tkn^]
  Use username `{gitlab_user}` and password `{gitlab_user_password}`

image::tekton-prod-1.png[]

* Navigate to *Deploy > Releases > Create a new release*

image::tekton-prod-2.png[]

* Select an existing tag (e.g., `v1.0`) or create a new one

* Optionally, enter release notes

* Click *Create release*

image::tekton-prod-3.png[]

* Go to the `my-quarkus-tkn` component in *Developer Hub*

* Click the **CI** tab

* Look for a pipeline run labeled **promote-to-prod** and expand it to view details

image::tekton-prod-4.png[]

== Pipeline Tasks

Know:: ACME's leadership needs to see that production deployments are now safer AND faster than ever before — each pipeline task proves that automation reduces risk while accelerating delivery.

**Business Value of Production Pipeline Automation:**
* **Regulatory Compliance:** SOC 2, PCI, and audit requirements met automatically (saves weeks of manual evidence gathering)
* **Risk Prevention:** Security violations caught before they reach customers (prevents costly incidents and reputation damage)
* **Operational Efficiency:** Zero manual reviews or human bottlenecks (platform teams focus on innovation, not validation)
* **Revenue Protection:** Confident deployments during peak shopping seasons (no Black Friday downtime fears)

=== Task 1.1: `extract-destination-image-tag`

Know:: ACME needs perfect traceability for audit and compliance purposes — this task ensures every production deployment can be traced back to its exact source.

**Business Value:**
* **Audit Confidence:** Regulators can trace every production change to its source developer and approval
* **Compliance Automation:** SOC 2 and PCI requirements satisfied without manual documentation
* **Risk Management:** If issues arise, ACME knows exactly what was deployed and when

The Git tag (e.g., `v1.0`) becomes ACME's source of truth for all validations and provides the traceability required for enterprise compliance.

=== Task 1.2: `gather-images-to-verify`

Know:: ACME's business requires absolute certainty about what goes to production — this task creates the definitive record that prevents deployment confusion and ensures regulatory compliance.

**Traditional ACME Challenge:**
* Multiple image versions floating around with unclear provenance
* Manual tracking leads to deployment mistakes and audit failures
* Production incidents caused by deploying wrong versions

**RHADS Business Solution:**
* **Perfect Traceability:** Every production image linked definitively to its source code
* **Error Prevention:** Impossible to deploy the wrong version accidentally
* **Audit Ready:** Complete metadata available instantly for compliance reviews

The `images.json` file becomes ACME's legal proof of what was deployed and why — essential for regulatory compliance and incident response.

Show:: The Git release is mapped to the image produced during staging by this task. The tag is used to locate the previously built container image and a metadata file named `images.json` is created.

.Sample `images.json` can be shown
[source,json,subs="attributes"]
----
{
  "components": [
    {
      "containerImage": "quay.tssc-quay/tssc/my-quarkus-jnk:v1.0",
      "source": {
        "git": {
          "url": "{gitlab_url}/development/my-quarkus-jnk",
          "revision": "v1.0"
        }
      }
    }
  ]
}
----

This metadata ensures traceability — the image is linked back to its source code and it is verified that it hasn't been tampered with.

=== Task 2: `verify-enterprise-contract`

Know:: ACME's most critical business protection — automated security validation that prevents costly production incidents while eliminating manual security review delays.

**Business Risk Without Automated Validation:**
* Security vulnerabilities in production could cost millions in damages and compliance fines
* Manual security reviews create 2-3 week deployment delays
* Human error in security checks leads to production incidents
* Inconsistent security standards across different teams and deployments

**RHADS Business Protection:**
* **Zero Security Incidents:** Automated validation catches issues before they reach customers
* **100% Consistent Standards:** Every deployment meets the same enterprise security policies
* **Instant Compliance:** SOC 2, PCI, and regulatory requirements enforced automatically
* **No Deployment Delays:** Security validation happens in minutes, not weeks

**Enterprise Security Validations Performed:**
* **Digital signature verification:** Proves the image hasn't been tampered with
* **SBOM validation:** Complete dependency scanning for vulnerability management
* **Provenance verification:** Confirms the image came from trusted build processes
* **CVE scanning:** Automatic vulnerability detection and policy enforcement
* **Organizational policy compliance:** Custom security rules enforced automatically

**Business Impact for ACME:**
* Security incident prevention: Saves potential millions in damages
* Compliance confidence: Automatic evidence for audits
* Deployment velocity: Minutes instead of weeks for security approval
* Risk mitigation: 100% consistent security enforcement

[NOTE]
====
*Enterprise Contract (EC)* protects ACME's business by ensuring only compliant, secure images reach production.

*TUF (The Update Framework)* prevents tampering with security metadata — protecting ACME from supply chain attacks.

*SBOM (Software Bill of Materials)* enables rapid vulnerability response — critical for ACME's security posture.

*Provenance* proves build integrity — essential for ACME's compliance and audit requirements.
====

Failed validation demonstrates ACME's protection — the pipeline halts automatically if any security check fails, preventing risky deployments.

Show:: Supply chain security checks occur at this point.

Step 1: Trust is initialized by the pipeline via Cosign:

[source,bash]
----
cosign initialize \
  --mirror http://tuf.tssc-tas.svc \
  --root http://tuf.tssc-tas.svc/root.json
----

Step 2: The image is validated by Enterprise Contract:

[source,bash]
----
ec validate image \
  --image quay.tssc-quay/tssc/my-quarkus-tkn:v1.0 \
  --policy git::github.com/org/ec-policies//default \
  --public-key k8s://openshift/trusted-keys \
  --output json
----

The following validations are performed:

* Digital signature with Cosign
* SBOM presence (e.g., SPDX, CycloneDX)
* Provenance metadata (how the image was built)
* CVE scanning
* Organizational policy compliance

A failed validation can be simulated (e.g., by modifying the EC policy or image) to demonstrate that the pipeline halts if verification fails.

=== Task 3: `copy-image`

Know:: ACME's quality gate for production readiness — only images that pass enterprise security validation earn the "production-ready" designation.

**Business Value of Production Tagging:**
* **Clear Production Intent:** `prod-v1.0` tag signals this image passed all enterprise security checks
* **Audit Trail:** Complete traceability from source code to production deployment
* **Risk Mitigation:** Only validated, compliant images can reach ACME's customers
* **Operational Clarity:** Teams know instantly which images are production-approved

**Why This Matters for ACME's Business:**
* **Incident Prevention:** Only security-validated images deployed to customer-facing systems
* **Compliance Confidence:** Audit trail proving every production image was properly validated
* **Operational Excellence:** Clear separation between development, staging, and production-ready artifacts
* **Risk Management:** Impossible to accidentally deploy non-validated images

The `prod-` prefix becomes ACME's guarantee that this image met all enterprise security and compliance requirements.

Show:: Now that the image has passed all security checks, it is promoted to production by tagging it with a release label.

[source,bash]
----
skopeo copy \
  docker://quay.tssc-quay/tssc/my-quarkus-tkn:v1.0 \
  docker://quay.tssc-quay/tssc/my-quarkus-tkn:prod-v1.0
----

The previously validated image is promoted by this command by creating a new tag prefixed with `prod-`.

* This tag (`prod-v1.0`) clearly identifies the image as production-ready.
* Traceability is ensured — the exact source and validation steps that led to this image are known.
* Only images that pass EC validation make it this far, preventing unsafe code from being deployed.
* Argo CD will watch for this tag and deploy it to the production environment.

=== Task 4: `update-deployment`

Know:: ACME's automated bridge from security validation to customer value — GitOps ensures validated changes reach production automatically without manual intervention or risk.

**Traditional ACME Production Deployment Risks:**
* Manual deployment steps prone to human error during critical releases
* Emergency changes bypass proper validation under pressure
* Inconsistent deployment processes across different teams
* Production changes without proper audit trails

**RHADS Business Benefits:**
* **Zero Manual Errors:** GitOps automation eliminates human deployment mistakes
* **100% Audit Trail:** Every production change tracked and traceable
* **Consistent Process:** Same deployment method for routine and emergency changes
* **Continuous Compliance:** All changes follow the same validated security process

**Business Impact for ACME:**
* **Deployment Confidence:** Argo CD ensures exactly what was validated gets deployed
* **Risk Elimination:** No manual steps that could introduce errors during critical releases
* **Compliance Automation:** Production environment continuously reflects audited Git state
* **Operational Excellence:** Standardized deployment process across all ACME services

The GitOps overlay system ensures ACME's production environment stays secure, compliant, and traceable — while enabling rapid deployment of business-critical features.

Show:: The GitOps repo is updated next so Argo CD knows to deploy the newly promoted image.

The following file is updated by the pipeline:

[source,yaml]
----
apiVersion: apps/v1
kind: Deployment
metadata:
  name: my-quarkus-tkn
spec:
  template:
    spec:
      containers:
        - name: my-quarkus-tkn
          image: quay.tssc-quay/tssc/my-quarkus-tkn:prod-v1.0
----

This file lives at:

`overlays/prod/deployment-patch.yaml`

The patch is picked up by this `kustomization.yaml`:

[source,yaml]
----
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
  - ../../base
patchesStrategicMerge:
  - deployment-patch.yaml
----

* The container image reference in the production overlay is updated by this patch.
* This patch is committed and pushed to the GitOps repository by OpenShift Pipelines.
* Argo CD is watching this repo — as soon as the change is detected, the deployment is synced to the `prod` cluster.
* Only verified, tagged images are deployed by this process, and the entire process is fully auditable.

== Wrap-Up

=== Summary of Tasks

|===
| Task | Description

| Git Release
| Triggered via GitLab Release from Tag

| 1.1 extract-destination-image-tag
| Extracts the Git tag attached to the release to be used as part of the destination image tag

| 1.2 gather-images-to-verify
| Resolves tag to commit and generates `images.json` pointing to the image to be validated

| 2 verify-enterprise-contract
| Validates signature, SBOM, provenance, CVEs, and organizational policy using Enterprise Contract

| 3 copy-image
| Copies the previously staged image and tags it as `prod-v1.0`

| 4 update-deployment
| Updates `overlays/prod` in the GitOps repo, which triggers an Argo CD deployment
|===

=== Key Takeaways

Know:: ACME's production deployment transformation demonstrates how enterprise security and business velocity reinforce each other:

**Business Results Achieved:**
* **Deployment Speed:** Production releases from 2-3 weeks → 30 minutes
* **Security Confidence:** 100% automated policy enforcement with zero manual bottlenecks
* **Risk Reduction:** Eliminated human error from production deployment process
* **Compliance Automation:** SOC 2 and PCI evidence generated automatically
* **Operational Excellence:** Consistent, auditable process across all ACME services

**Strategic Business Value:**
* **Competitive Advantage:** Deploy features while competitors wait for security approval
* **Revenue Protection:** Confident production deployments during peak shopping seasons
* **Cost Efficiency:** Platform teams focus on innovation instead of manual validation
* **Risk Management:** Enterprise-grade security without enterprise-grade delays
* **Audit Readiness:** Continuous compliance evidence instead of periodic scrambling

== Optional Enhancements

Know:: These demonstrations can reinforce ACME's transformation and address specific customer concerns:

**Demonstrating ACME's Security Protection:**
* Simulate a failed validation to show Enterprise Contract blocking unsafe deployments
* Show how ACME's security is enforced automatically, even under pressure

**Showing ACME's Operational Excellence:**
* Display image tags in Quay showing both staged (`:v1.0`) and production-ready (`:prod-v1.0`) versions
* Demonstrate Argo CD automatically syncing validated changes to production

**Proving ACME's Compliance Readiness:**
* Show Enterprise Contract policy bundles that define ACME's security requirements
* Explain how the same process works for staging and production with different overlays

These enhancements prove that ACME achieved enterprise security without sacrificing business velocity.

