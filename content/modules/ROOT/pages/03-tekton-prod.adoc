= Advanced Developer Suite Demo Narrative
Red Hat Advanced Developer Suite with Enterprise Contract and GitOps Promotion
:icons: font
:source-highlighter: rouge
:toc: macro
:toclevels: 1

toc::[]

== Overview

Know:: ACME's Black Friday success requires safe, fast production deployments. RHADS transforms risky manual processes into confident automated workflows.

**ACME's Production Deployment Challenge:**
* Traditional production releases take 2-3 weeks of manual security reviews
* Each production deployment risks downtime during peak shopping season
* Manual validation processes create opportunities for human error
* Security teams become bottlenecks during critical release cycles

**The Business Stakes:**
* Black Friday downtime could cost ACME $50,000+ per minute in lost sales
* Failed deployments during peak season damage customer trust and revenue
* Manual processes don't scale during high-velocity release periods
* Compliance violations could trigger expensive audit failures

**How RHADS Solves ACME's Production Risk:**
This module demonstrates how ACME now:

* Deploys to production with zero manual security reviews (saves 2-3 weeks per release)
* Automatically validates every production candidate before deployment
* Eliminates human error through automated policy enforcement
* Maintains complete audit trails for SOC 2 and PCI compliance

The result: ACME deploys confidently to production while reducing risk and accelerating delivery.

[NOTE]
====
The examples and commands in this guide are representative of the *ACME* demo environment. Actual repository URLs, credentials, or config should be replaced as needed in your setup.
====

== Pipeline Flow

Know:: ACME's transformation from manual production releases to automated confidence — Git release triggers enterprise-grade security validation automatically.

**Business Value:**

* Production deployment time: 2-3 weeks → 30 minutes
* 100% automated security compliance 
* Zero manual review bottlenecks
* Complete audit trail generated automatically

Show::
* Open your GitLab repository: {gitlab_url}/development/my-quarkus-tkn[my-quarkus-tkn^]
  Use username `{gitlab_user}` and password `{gitlab_user_password}`

image::tekton-prod-1.png[]

* Navigate to *Deploy > Releases > Create a new release*

image::tekton-prod-2.png[]

* Select an existing tag (e.g., `v1.0`) or create a new one

* Optionally, enter release notes

* Click *Create release*

image::tekton-prod-3.png[]

* Go to the `my-quarkus-tkn` component in *Developer Hub*

* Click the **CI** tab

* Look for a pipeline run labeled **promote-to-prod** and expand it to view details

image::tekton-prod-4.png[]

== Pipeline Tasks

Know:: ACME's production deployments are now safer AND faster — automation reduces risk while accelerating delivery.

**Business Value:**

* SOC 2/PCI compliance automated (saves weeks of manual evidence)
* Security violations caught before reaching customers
* Zero manual review bottlenecks
* Confident deployments during peak shopping seasons

=== Task 1.1: `extract-destination-image-tag`

Know:: ACME gets perfect traceability — Git tags provide complete audit trail and compliance automation.

=== Task 1.2: `gather-images-to-verify`

Know:: ACME gets absolute certainty about production deployments — `images.json` provides definitive proof of what was deployed and why.

Show:: The Git release is mapped to the image produced during staging by this task. The tag is used to locate the previously built container image and a metadata file named `images.json` is created.

.Sample `images.json` can be shown
[source,json,subs="attributes"]
----
{
  "components": [
    {
      "containerImage": "quay.tssc-quay/tssc/my-quarkus-jnk:v1.0",
      "source": {
        "git": {
          "url": "{gitlab_url}/development/my-quarkus-jnk",
          "revision": "v1.0"
        }
      }
    }
  ]
}
----

This metadata ensures traceability — the image is linked back to its source code and it is verified that it hasn't been tampered with.

=== Task 2: `verify-enterprise-contract`

Know:: ACME's most critical business protection — automated security validation that prevents costly production incidents while eliminating manual security review delays.

**Business Risk Without Automated Validation:**
* Security vulnerabilities in production could cost millions in damages and compliance fines
* Manual security reviews create 2-3 week deployment delays
* Human error in security checks leads to production incidents
* Inconsistent security standards across different teams and deployments

**RHADS Business Protection:**
* **Zero Security Incidents:** Automated validation catches issues before they reach customers
* **100% Consistent Standards:** Every deployment meets the same enterprise security policies
* **Instant Compliance:** SOC 2, PCI, and regulatory requirements enforced automatically
* **No Deployment Delays:** Security validation happens in minutes, not weeks

**Enterprise Security Validations Performed:**
* **Digital signature verification:** Proves the image hasn't been tampered with
* **SBOM validation:** Complete dependency scanning for vulnerability management
* **Provenance verification:** Confirms the image came from trusted build processes
* **CVE scanning:** Automatic vulnerability detection and policy enforcement
* **Organizational policy compliance:** Custom security rules enforced automatically

**Business Impact for ACME:**
* Security incident prevention: Saves potential millions in damages
* Compliance confidence: Automatic evidence for audits
* Deployment velocity: Minutes instead of weeks for security approval
* Risk mitigation: 100% consistent security enforcement

[NOTE]
====
*Enterprise Contract (EC)* protects ACME's business by ensuring only compliant, secure images reach production.

*TUF (The Update Framework)* prevents tampering with security metadata — protecting ACME from supply chain attacks.

*SBOM (Software Bill of Materials)* enables rapid vulnerability response — critical for ACME's security posture.

*Provenance* proves build integrity — essential for ACME's compliance and audit requirements.
====

Failed validation demonstrates ACME's protection — the pipeline halts automatically if any security check fails, preventing risky deployments.

Show:: Supply chain security checks occur at this point.

Step 1: Trust is initialized by the pipeline via Cosign:

[source,bash]
----
cosign initialize \
  --mirror http://tuf.tssc-tas.svc \
  --root http://tuf.tssc-tas.svc/root.json
----

Step 2: The image is validated by Enterprise Contract:

[source,bash]
----
ec validate image \
  --image quay.tssc-quay/tssc/my-quarkus-tkn:v1.0 \
  --policy git::github.com/org/ec-policies//default \
  --public-key k8s://openshift/trusted-keys \
  --output json
----

The following validations are performed:

* Digital signature with Cosign
* SBOM presence (e.g., SPDX, CycloneDX)
* Provenance metadata (how the image was built)
* CVE scanning
* Organizational policy compliance

A failed validation can be simulated (e.g., by modifying the EC policy or image) to demonstrate that the pipeline halts if verification fails.

=== Task 3: `copy-image`

Know:: ACME's quality gate — only validated images earn "prod-" designation, ensuring enterprise security compliance.

Show:: Now that the image has passed all security checks, it is promoted to production by tagging it with a release label.

[source,bash]
----
skopeo copy \
  docker://quay.tssc-quay/tssc/my-quarkus-tkn:v1.0 \
  docker://quay.tssc-quay/tssc/my-quarkus-tkn:prod-v1.0
----

The previously validated image is promoted by this command by creating a new tag prefixed with `prod-`.

* This tag (`prod-v1.0`) clearly identifies the image as production-ready.
* Traceability is ensured — the exact source and validation steps that led to this image are known.
* Only images that pass EC validation make it this far, preventing unsafe code from being deployed.
* Argo CD will watch for this tag and deploy it to the production environment.

=== Task 4: `update-deployment`

Know:: ACME's automated bridge from security validation to customer value — GitOps ensures validated changes reach production automatically without manual intervention or risk.

**Traditional ACME Production Deployment Risks:**
* Manual deployment steps prone to human error during critical releases
* Emergency changes bypass proper validation under pressure
* Inconsistent deployment processes across different teams
* Production changes without proper audit trails

**RHADS Business Benefits:**
* **Zero Manual Errors:** GitOps automation eliminates human deployment mistakes
* **100% Audit Trail:** Every production change tracked and traceable
* **Consistent Process:** Same deployment method for routine and emergency changes
* **Continuous Compliance:** All changes follow the same validated security process

**Business Impact for ACME:**
* **Deployment Confidence:** Argo CD ensures exactly what was validated gets deployed
* **Risk Elimination:** No manual steps that could introduce errors during critical releases
* **Compliance Automation:** Production environment continuously reflects audited Git state
* **Operational Excellence:** Standardized deployment process across all ACME services

The GitOps overlay system ensures ACME's production environment stays secure, compliant, and traceable — while enabling rapid deployment of business-critical features.

Show:: The GitOps repo is updated next so Argo CD knows to deploy the newly promoted image.

The following file is updated by the pipeline:

[source,yaml]
----
apiVersion: apps/v1
kind: Deployment
metadata:
  name: my-quarkus-tkn
spec:
  template:
    spec:
      containers:
        - name: my-quarkus-tkn
          image: quay.tssc-quay/tssc/my-quarkus-tkn:prod-v1.0
----

This file lives at:

`overlays/prod/deployment-patch.yaml`

The patch is picked up by this `kustomization.yaml`:

[source,yaml]
----
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
  - ../../base
patchesStrategicMerge:
  - deployment-patch.yaml
----

* The container image reference in the production overlay is updated by this patch.
* This patch is committed and pushed to the GitOps repository by OpenShift Pipelines.
* Argo CD is watching this repo — as soon as the change is detected, the deployment is synced to the `prod` cluster.
* Only verified, tagged images are deployed by this process, and the entire process is fully auditable.

== Wrap-Up

=== Summary of Tasks

|===
| Task | Description

| Git Release
| Triggered via GitLab Release from Tag

| 1.1 extract-destination-image-tag
| Extracts the Git tag attached to the release to be used as part of the destination image tag

| 1.2 gather-images-to-verify
| Resolves tag to commit and generates `images.json` pointing to the image to be validated

| 2 verify-enterprise-contract
| Validates signature, SBOM, provenance, CVEs, and organizational policy using Enterprise Contract

| 3 copy-image
| Copies the previously staged image and tags it as `prod-v1.0`

| 4 update-deployment
| Updates `overlays/prod` in the GitOps repo, which triggers an Argo CD deployment
|===

=== Key Takeaways

Know:: ACME's production transformation demonstrates how enterprise security and business velocity reinforce each other.

**Business Value:**

* Production releases: 2-3 weeks → 30 minutes
* 100% automated security compliance
* Deploy features while competitors wait for approval
* Continuous compliance evidence generated automatically

== Optional Enhancements

Know:: Optional demonstrations to show ACME's transformation — simulate failed validations, display Quay image tags, demonstrate Argo CD syncing, and show Enterprise Contract policies.

